-- MySQL Script generated by MySQL Workbench
-- Tue Oct 27 15:24:56 2020
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `mydb` ;

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
USE `mydb` ;

-- -----------------------------------------------------
-- Table `mydb`.`cliente`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`cliente` ;

CREATE TABLE IF NOT EXISTS `mydb`.`cliente` (
  `idcliente` CHAR(11) NOT NULL,
  `nome` VARCHAR(45) NOT NULL,
  `email` VARCHAR(45) NULL,
  `endereco` VARCHAR(45) NULL,
  PRIMARY KEY (`idcliente`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`empresa`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`empresa` ;

CREATE TABLE IF NOT EXISTS `mydb`.`empresa` (
  `idempresa` CHAR(14) NOT NULL,
  `nome_empresa` VARCHAR(45) NOT NULL,
  `endereco_empresa` VARCHAR(45) NULL,
  PRIMARY KEY (`idempresa`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`produto`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`produto` ;

CREATE TABLE IF NOT EXISTS `mydb`.`produto` (
  `idproduto` INT NOT NULL,
  `nome_produto` VARCHAR(45) NOT NULL,
  `descricao` LONGTEXT NULL,
  `valor` DECIMAL NOT NULL,
  `valorDesconto` DECIMAL NULL,
  `empresa_idempresa` CHAR(14) NOT NULL,
  PRIMARY KEY (`idproduto`),
  CONSTRAINT `fk_produto_empresa1`
    FOREIGN KEY (`empresa_idempresa`)
    REFERENCES `mydb`.`empresa` (`idempresa`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`venda_has_produto`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`venda_has_produto` ;

CREATE TABLE IF NOT EXISTS `mydb`.`venda_has_produto` (
`fk_idvenda` INT NOT NULL,
  `fk_idCliente` CHAR(11) NOT NULL,
  `fk_produto_idproduto` INT NOT NULL,
  PRIMARY KEY (`fk_idvenda`,`fk_idCliente`, `fk_produto_idproduto`),
   CONSTRAINT`fk_idCliente`
    FOREIGN KEY (`fk_idCliente`)
    REFERENCES `mydb`.`cliente` (`idcliente`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_produto_idproduto`
    FOREIGN KEY (`fk_produto_idproduto`)
    REFERENCES `mydb`.`produto` (`idproduto`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`avaliacao`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`avaliacao` ;

CREATE TABLE IF NOT EXISTS `mydb`.`avaliacao` (
  `idavaliacao` INT NOT NULL ,
  `valor` INT NULL,
  PRIMARY KEY (`idavaliacao`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`cliente_avaliacao_produto`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`cliente_avaliacao_produto` ;

CREATE TABLE IF NOT EXISTS `mydb`.`cliente_avaliacao_produto` (
  `cliente_idcliente` CHAR(11) NOT NULL,
  `produto_idproduto` INT NOT NULL,
  `avaliacao_idavaliacao` INT NOT NULL,
  PRIMARY KEY (`cliente_idcliente`, `produto_idproduto`, `avaliacao_idavaliacao`),
  CONSTRAINT `fk_cliente_has_produto_cliente1`
    FOREIGN KEY (`cliente_idcliente`)
    REFERENCES `mydb`.`cliente` (`idcliente`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_cliente_has_produto_produto1`
    FOREIGN KEY (`produto_idproduto`)
    REFERENCES `mydb`.`produto` (`idproduto`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_cliente_has_produto_avaliacao1`
    FOREIGN KEY (`avaliacao_idavaliacao`)
    REFERENCES `mydb`.`avaliacao` (`idavaliacao`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`comentario`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`comentario` ;

CREATE TABLE IF NOT EXISTS `mydb`.`comentario` (
  `idcomentario` INT NOT NULL AUTO_INCREMENT,
  `texto` LONGTEXT NULL,
  `produto_idproduto` INT NOT NULL,
  `cliente_idcliente` CHAR(11) NOT NULL,
  PRIMARY KEY (`idcomentario`),
  CONSTRAINT `fk_comentario_produto1`
    FOREIGN KEY (`produto_idproduto`)
    REFERENCES `mydb`.`produto` (`idproduto`)
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_comentario_cliente1`
    FOREIGN KEY (`cliente_idcliente`)
    REFERENCES `mydb`.`cliente` (`idcliente`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


 INSERT  into cliente (idcliente, nome, email, endereco) VALUES('1','tiago','','');
 INSERT into cliente(idcliente, nome, email, endereco) VALUES('2','vitor','aaa@gmail.com','rua setenta');
 INSERT into cliente (idcliente, nome, email, endereco) VALUES('3','joao','bb@gmail.com','rua noventa');

 INSERT into empresa (idempresa, nome_empresa, endereco_empresa) VALUES('1','delicia da tia','rua noventa');
 INSERT into empresa (idempresa, nome_empresa, endereco_empresa) VALUES('2','delicia do cerrado','rua setenta');
 INSERT into empresa (idempresa, nome_empresa, endereco_empresa) VALUES('3','tio joao','rua seis');
 
  INSERT into produto (idproduto, nome_produto, descricao,valor,valorDesconto,empresa_idempresa) VALUES('11','açai','açai com morango e leite condensado','11.00','1.00','1');
 INSERT into produto (idproduto, nome_produto, descricao,valor,valorDesconto,empresa_idempresa) VALUES('22','macarrao','macarrao delicioso','15.00','0.00','2');
 INSERT into produto (idproduto, nome_produto, descricao,valor,valorDesconto,empresa_idempresa) VALUES('33','açai','açai com morango e leite condensado','12.00','1.00','2');
 INSERT into produto (idproduto, nome_produto, descricao,valor,valorDesconto,empresa_idempresa) VALUES('44','sorvete','sorvete napolitano','5.00','1.00','2');
 INSERT into produto (idproduto, nome_produto, descricao,valor,valorDesconto,empresa_idempresa) VALUES('55','bife a milanesa','Bife a milanesa. acompanha: Arroz, feijão e batata frita.','12.00','2.00','1');
 INSERT into produto (idproduto, nome_produto, descricao,valor,valorDesconto,empresa_idempresa) VALUES('66','açai','açai com morango.','8.00','1.00','3');
 
 
 
       INSERT into cliente_avaliacao_produto (cliente_idcliente, produto_idproduto,avaliacao_idavaliacao) VALUES('1','11','1');
INSERT into cliente_avaliacao_produto (cliente_idcliente, produto_idproduto,avaliacao_idavaliacao) VALUES('1','33','2');
INSERT into cliente_avaliacao_produto (cliente_idcliente, produto_idproduto,avaliacao_idavaliacao) VALUES('2','11','3');
INSERT into cliente_avaliacao_produto (cliente_idcliente, produto_idproduto,avaliacao_idavaliacao) VALUES('3','44','4');
INSERT into cliente_avaliacao_produto (cliente_idcliente, produto_idproduto,avaliacao_idavaliacao) VALUES('3','33','5');
INSERT into cliente_avaliacao_produto (cliente_idcliente, produto_idproduto,avaliacao_idavaliacao) VALUES('1','22','6');

 INSERT into avaliacao (idavaliacao, valor) VALUES('1','3');
  INSERT into avaliacao (idavaliacao, valor) VALUES('2','5');
   INSERT into avaliacao (idavaliacao, valor) VALUES('3','4');
    INSERT into avaliacao (idavaliacao, valor) VALUES('4','5');
     INSERT into avaliacao (idavaliacao, valor) VALUES('5','3');
      INSERT into avaliacao (idavaliacao, valor) VALUES('6','2');
     
	INSERT into comentario (texto, produto_idproduto,cliente_idcliente) VALUES('muito bom','11','1');
	INSERT into comentario (texto, produto_idproduto,cliente_idcliente) VALUES('top','11','1');
	INSERT into comentario (texto, produto_idproduto,cliente_idcliente) VALUES('gostei','22','3');
	INSERT into comentario (texto, produto_idproduto,cliente_idcliente) VALUES('vale a pena','33','2');
	INSERT into comentario (texto, produto_idproduto,cliente_idcliente) VALUES('bom gosto','55','2');
	INSERT into comentario (texto, produto_idproduto,cliente_idcliente) VALUES('da p ser melhor','22','1');
   
    INSERT into venda_has_produto (fk_idvenda, fk_idCliente, fk_produto_idproduto) VALUES('1','1','11');
  INSERT into venda_has_produto(fk_idvenda, fk_idCliente, fk_produto_idproduto) VALUES('2','1','22');
  INSERT into venda_has_produto (fk_idvenda, fk_idCliente, fk_produto_idproduto) VALUES('3','2','11');
  INSERT into venda_has_produto (fk_idvenda, fk_idCliente, fk_produto_idproduto) VALUES('4','3','33');
  INSERT into venda_has_produto (fk_idvenda, fk_idCliente, fk_produto_idproduto) VALUES('5','2','66');
 INSERT into venda_has_produto (fk_idvenda, fk_idCliente, fk_produto_idproduto) VALUES('6','3','55');
 INSERT into venda_has_produto (fk_idvenda, fk_idCliente, fk_produto_idproduto) VALUES('7','1','44');
 INSERT into venda_has_produto (fk_idvenda, fk_idCliente, fk_produto_idproduto) VALUES('8','3','22');
SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

select*from cliente;
select*from avaliacao;
select*from comentario;
select*from empresa;
select*from produto;
select*from venda_has_produto;
select*from cliente_avaliacao_produto;

select c.nome, co.texto 'comentario' , p.nome_produto 'produto', e.nome_empresa 'empresa' from cliente c
inner join comentario co 
on c.idcliente=co.cliente_idcliente
inner join produto p
 on co.produto_idproduto=p.idproduto
 inner join empresa e
 on p.empresa_idempresa= e.idempresa;
